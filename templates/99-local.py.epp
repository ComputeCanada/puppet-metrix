import pymysql
pymysql.install_as_MySQLdb()

SECRET_KEY = '<%= $secret_key %>'
DEBUG = False

ALLOWED_HOSTS = ['127.0.0.1', 'localhost']
CSRF_TRUSTED_ORIGINS = ['https://<%= $subdomain %>.<%= $domain_name %>']

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'django.contrib.humanize',
    'csp',
    'watchman',

    'pages',
    'slurm',
    'notes',

    'jobstats',
    'top',

    'ccldap',

    # system modules
    'rest_framework',
    'rest_framework.authtoken',
    'bootstrap_pagination',
]

AUTH_LDAP_SERVER_URI = 'ldaps://ipa.int.<%= $domain_name %>/'
AUTH_LDAP_BIND_DN = 'uid=admin,cn=users,cn=accounts,<%= $base_dn %>',
AUTH_LDAP_BIND_PASSWORD = '<%= $ldap_password %>'
AUTH_LDAP_USER_DN_TEMPLATE = "uid=%(user)s,cn=users,cn=accounts,<%= $base_dn %>"

LDAP_BASE_DN = '<%= $base_dn %>'


DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'metrix',
        'USER': 'metrix',
        'PASSWORD': '<%= $password %>',
        'HOST': '<%= $db_ip %>',
        'PORT': '<%= $db_port %>',
    },
    'slurm': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'slurm_acct_db',
        'USER': 'slurm',
        'PASSWORD': '<%= $slurm_password %>',
        'HOST': '<%= $db_ip %>',
        'PORT': '<%= $db_port %>',
    },
    'ldap': {
        'ENGINE': 'ldapdb.backends.ldap',
        'NAME': AUTH_LDAP_SERVER_URI,
        'USER': AUTH_LDAP_BIND_DN,
        'PASSWORD': AUTH_LDAP_BIND_PASSWORD,
    },
}

import ldap
ldap.set_option(ldap.OPT_X_TLS_REQUIRE_CERT, ldap.OPT_X_TLS_ALLOW)

PROMETHEUS = {
    'url': 'http://<%= $prometheus_ip %>:<%= $prometheus_port %>',
    'headers': {},
    'filter': {
        'default': ''
    }
}

STATIC_URL = '/static/'
STATIC_ROOT = '/var/www/metrix-static/'

AUTHENTICATION_BACKENDS = [
    'django_auth_ldap.backend.LDAPBackend',
    'django.contrib.auth.backends.ModelBackend',
]

LOGIN_URL = '/accounts/login/' # So it does not use SAML2

EXPORTER_INSTALLED = [
    'slurm-job-exporter',
    'node_exporter',
    'slurm_exporter',
]

CLUSTER_NAME = '<%= $cluster_name %>'  # used for slurm DB name
LUSTRE_FS_NAMES = None
LOGINS = {
<% $logins.each |$hostname| { -%>
    '<%= $hostname %>': {
        'network_interface': 'eth0',
    },
<% } -%>
}
DTNS = { }

AMORTIZATION_YEARS = None
CPU_CORE_COST_PER_HOUR = None
GPU_COST_PER_HOUR = None

ELECTRICITY_COST_PER_KWH = None
COOLING_COST_PER_KWH = None
CO2_KG_PER_MWH = None
ELECTRIC_CAR_RANGE_KM_PER_KWH = None

CLOUD_CPU_CORE_COST_PER_HOUR = None
CLOUD_GPU_COST_PER_HOUR = None

# Used to set reasonable thresholds for the mem usage in the "top compute" page
NORMAL_MEM_BY_CORE = 256/64 * 1024 * 1024 * 1024  # 256GB for 64 cores
NORMAL_MEM_BY_GPU = 512 / 4 * 1024 * 1024 * 1024  # 512GB for 4 GPUs
NORMAL_CORES_BY_GPU = 48 / 4  # 48 cores for 4 GPUs

SLURM_TRES = {
    '1001=': 'NVIDIA A100-SXM4-40GB',
}

CLUSTER_NAME_TITLE = '<%= $cluster_name %>'
FAVICON = 'https://raw.githubusercontent.com/computecanada/magic_castle/assets/logo.png'

CLUSTER_INTRO = """
<p><%= $cluster_name %>'s cluster</p>
"""
